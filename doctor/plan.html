<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Kun Tartibi - Shifokor Kabineti</title>
  <meta content="Shifokorning ish jadvali va uchrashuvlarini boshqarish" name="description">
  <meta content="medmap, doctor, cabinet, schedule, calendar, appointments, timeline" name="keywords">

  <!-- Favicons -->
  <link href="https://placehold.co/32x32/4154f1/ffffff?text=M" rel="icon">
  <link href="https://placehold.co/180x180/4154f1/ffffff?text=M" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Main CSS File -->
   <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="plan.css">

  <!-- Vendor CSS Files -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

</head>

<body>

<div class="wrapper">
  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">
    <a href="index.html" class="logo d-flex align-items-center">
      <img src="../images/MedMapp_Logo_shaffof.png"  alt="MedMap Logo" class="logo-full">
      <img src="../images/favicon.png" alt="MedMap Icon" class="logo-icon">
    </a>
    <div class="sidebar-nav nav flex-column mt-4 flex-grow-1">
      <a class="nav-link" href="index.html"><i class="bi bi-grid-1x2-fill"></i><span>Boshqaruv Paneli</span></a>
      <a class="nav-link active" href="plan.html"><i class="bi bi-calendar2-week"></i><span>Kun Tartibi</span></a>
      <a class="nav-link" href="patients.html"><i class="bi bi-people"></i><span>Bemorlar</span></a>
      <a class="nav-link" href="messages.html"><i class="bi bi-chat-dots"></i><span>Xabarlar</span></a>
      <a class="nav-link" href="settings.html"><i class="bi bi-person-circle"></i><span>Profil Sozlamalari</span></a>
    </div>
    <div class="logout">
        <a class="nav-link" href="login.html"><i class="bi bi-box-arrow-left"></i><span>Chiqish</span></a>
    </div>
  </aside><!-- End Sidebar-->

  <div class="main-content">
    <!-- ======= Header ======= -->
    <header class="header d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
            <i class="bi bi-list toggle-sidebar-btn me-3 fs-4"></i>
        </div>
      <nav class="header-nav d-flex align-items-center">
          <a class="nav-link nav-icon" id="dark-mode-toggle" href="#" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Tungi/Kunduzgi rejim">
              <i class="bi bi-moon-stars"></i>
          </a>
          <div class="nav-item dropdown">
            <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown" aria-expanded="false" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Til">
                <i class="bi bi-translate"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item active" href="#">O'zbekcha (UZ)</a></li>
                <li><a class="dropdown-item" href="#">Русский (RU)</a></li>
            </ul>
          </div>
          <a class="nav-link nav-icon" href="#" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Bildirishnomalar"><i class="bi bi-bell"></i></a>
          <div class="vr h-50 d-none d-sm-block mx-2"></div>
          <div class="nav-item dropdown">
            <a class="nav-link nav-profile d-flex align-items-center ps-sm-2" href="#" data-bs-toggle="dropdown">
              <img src="https://placehold.co/40x40/4154f1/ffffff?text=SN" alt="Profile" class="rounded-circle">
              <div class="d-none d-md-flex flex-column align-items-start ms-2">
                  <span class="fw-bold">Dr. Salima Nosirova</span>
                  <span class="text-muted small">Kardiolog</span>
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
              <li> <a class="dropdown-item d-flex align-items-center" href="#"> <i class="bi bi-person"></i> <span>Profil</span> </a> </li>
              <li> <hr class="dropdown-divider"> </li>
              <li> <a class="dropdown-item d-flex align-items-center" href="#"> <i class="bi bi-box-arrow-right"></i> <span>Chiqish</span> </a> </li>
            </ul>
          </div>
      </nav>
    </header><!-- End Header -->

    <main class="page-content">
      <section class="section schedule">
        
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
            <div class="pagetitle">
              <h1>Kun Tartibi</h1>
              <p class="text-muted mb-0" id="timeline-date-display"></p>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="btn-group">
                    <button class="btn btn-light border" id="prev-day"><i class="bi bi-chevron-left"></i></button>
                    <button class="btn btn-light border" id="today">Bugun</button>
                    <button class="btn btn-light border" id="next-day"><i class="bi bi-chevron-right"></i></button>
                </div>
                <input type="date" class="form-control" id="date-picker" style="width: auto;">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAppointmentModal">
                    <i class="bi bi-plus-circle me-2"></i>Yangi uchrashuv
                </button>
            </div>
        </div>
          
        <div class="card main-card">
            <div class="timeline-container">
                <div class="timeline-hours" id="timeline-hours"></div>
                <div class="timeline-body" id="timeline-body">
                    <div class="timeline-now-indicator" id="timeline-now-indicator"></div>
                </div>
            </div>
        </div>

      </section>
    </main>
  </div>
  <div class="mobile-overlay"></div>

  <!-- Uchrashuv Qo'shish Modal -->
  <div class="modal fade" id="addAppointmentModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Yangi Uchrashuv</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form><div class="mb-3"><label class="form-label">Bemor</label><input type="text" class="form-control" placeholder="Bemor ismini kiriting"></div><div class="mb-3"><label class="form-label">Xizmat turi</label><select class="form-select"><option selected>Tanlang...</option><option>Konsultatsiya</option><option>EKG</option><option>Takroriy ko'rik</option></select></div><div class="row"><div class="col-md-6 mb-3"><label class="form-label">Sana</label><input type="date" class="form-control"></div><div class="col-md-6 mb-3"><label class="form-label">Vaqt</label><input type="time" class="form-control"></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bekor qilish</button><button type="button" class="btn btn-primary">Belgilash</button></div></div></div></div>
  
  <!-- Uchrashuv Tafsilotlari Modal -->
  <div class="modal fade" id="appointmentDetailModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="modalTitle">Uchrashuv Tafsilotlari</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body" id="modalBody"></div><div class="modal-footer"><button type="button" class="btn btn-outline-secondary"><i class="bi bi-person-vcard me-2"></i>Bemor kartasi</button><button type="button" class="btn btn-primary"><i class="bi bi-pencil-square me-2"></i>Tahrirlash</button></div></div></div></div>

</div>

  <!-- Vendor JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  
  <!-- Asosiy JS Fayli -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      "use strict";

      const body = document.body;
      const htmlEl = document.documentElement;
      const toggleSidebarBtn = document.querySelector('.toggle-sidebar-btn');
      const mobileOverlay = document.querySelector('.mobile-overlay');
      const darkModeToggle = document.querySelector('#dark-mode-toggle');
      const detailModal = new bootstrap.Modal(document.getElementById('appointmentDetailModal'));

      // --- Sidebar Toggle Logic ---
      if (toggleSidebarBtn) {
        toggleSidebarBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (window.innerWidth < 1200) {
            body.classList.toggle('sidebar-toggled');
          } else {
            body.classList.toggle('sidebar-collapsed');
          }
        });
      }
      
      if (mobileOverlay) {
          mobileOverlay.addEventListener('click', () => {
              body.classList.remove('sidebar-toggled');
          });
      }
      
      // --- Dark Mode Logic ---
      if(darkModeToggle) {
          if (localStorage.getItem('theme') === 'dark') {
              htmlEl.classList.add('dark-mode');
              darkModeToggle.querySelector('i').classList.replace('bi-moon-stars', 'bi-sun');
          }

          darkModeToggle.addEventListener('click', (e) => {
              e.preventDefault();
              htmlEl.classList.toggle('dark-mode');
              const isDark = htmlEl.classList.contains('dark-mode');
              if (isDark) {
                  localStorage.setItem('theme', 'dark');
                  darkModeToggle.querySelector('i').classList.replace('bi-moon-stars', 'bi-sun');
              } else {
                  localStorage.setItem('theme', 'light');
                  darkModeToggle.querySelector('i').classList.replace('bi-sun', 'bi-moon-stars');
              }
          });
      }

      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      });
      
      // --- Timeline Logic ---
      const allAppointments = [
          { id: '1', title: 'Ali Valiyev', start: '2025-07-30T10:30:00', end: '2025-07-30T11:30:00', status: 'completed', service: 'Konsultatsiya', avatar: 'https://placehold.co/40x40/EFEFEF/333333?text=A', phone: '+998 90 123-45-67' },
          { id: '2', title: 'Jamila Ahmedova', start: '2025-07-30T11:30:00', end: '2025-07-30T12:00:00', status: 'in-progress', service: 'EKG', avatar: 'https://placehold.co/40x40/EFEFEF/333333?text=J', phone: '+998 91 234-56-78' },
          { id: '3', title: 'Sarvinoz Karimova', start: '2025-07-30T14:00:00', end: '2025-07-30T14:30:00', status: 'pending', service: 'Takroriy ko\'rik', avatar: 'https://placehold.co/40x40/EFEFEF/333333?text=S', phone: '+998 93 456-78-90' },
          { id: '4', title: 'Anvar Tursunov', start: '2025-07-31T09:00:00', end: '2025-07-31T09:45:00', status: 'pending', service: 'Konsultatsiya', avatar: 'https://placehold.co/40x40/EFEFEF/333333?text=A', phone: '+998 94 567-89-01' }
      ];

      let currentDate = new Date('2025-07-30T11:25:00'); // Set initial date for demonstration

      const timelineBody = document.getElementById('timeline-body');
      const timelineHours = document.getElementById('timeline-hours');
      const nowIndicator = document.getElementById('timeline-now-indicator');
      const dateDisplay = document.getElementById('timeline-date-display');
      const datePicker = document.getElementById('date-picker');
      const prevDayBtn = document.getElementById('prev-day');
      const nextDayBtn = document.getElementById('next-day');
      const todayBtn = document.getElementById('today');
      
      const startHour = 8;
      const endHour = 19;
      const hourHeight = 80; // px

      function renderTimeline(dateToRender) {
          // Clear previous state
          timelineBody.innerHTML = `<div class="timeline-now-indicator" id="timeline-now-indicator"></div>`;
          timelineHours.innerHTML = '';

          // Update date display
          dateDisplay.textContent = dateToRender.toLocaleDateString('uz-UZ', { day: 'numeric', month: 'long', year: 'numeric', weekday: 'long' });
          datePicker.value = dateToRender.toISOString().split('T')[0];

          // Generate hour markers
          for (let i = startHour; i <= endHour; i++) {
              const hourEl = document.createElement('div');
              hourEl.classList.add('timeline-hour');
              hourEl.textContent = `${i.toString().padStart(2, '0')}:00`;
              timelineHours.appendChild(hourEl);
          }

          // Filter appointments for the selected day
          const dayAppointments = allAppointments.filter(app => {
              const appDate = new Date(app.start);
              return appDate.toDateString() === dateToRender.toDateString();
          });

          // Render appointments
          dayAppointments.forEach(app => {
              const startDate = new Date(app.start);
              const endDate = new Date(app.end);
              const top = ((startDate.getHours() - startHour) * 60 + startDate.getMinutes()) * (hourHeight / 60);
              const height = ((endDate.getTime() - startDate.getTime()) / (1000 * 60)) * (hourHeight / 60) - 4;

              const card = document.createElement('div');
              card.className = `appointment-card status-${app.status}`;
              card.style.top = `${top}px`;
              card.style.height = `${Math.max(height, 40)}px`;
              card.dataset.id = app.id;

              card.innerHTML = `
                  <img src="${app.avatar}" class="patient-avatar" alt="${app.title}">
                  <div class="flex-grow-1">
                      <div class="fw-bold">${app.title}</div>
                      <div class="small text-muted">${app.service}</div>
                  </div>
                  <div class="text-end text-muted small">
                      ${startDate.toLocaleTimeString('uz-UZ', {hour: '2-digit', minute:'2-digit'})}
                  </div>
              `;
              
              card.addEventListener('click', () => {
                  const modalTitle = document.querySelector('#appointmentDetailModal .modal-title');
                  const modalBody = document.querySelector('#appointmentDetailModal #modalBody');
                  const startTime = startDate.toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });
                  const startDateString = startDate.toLocaleDateString('uz-UZ', { day: '2-digit', month: '2-digit', year: 'numeric' });
                  const formattedDateTime = `${startTime} | ${startDateString}`;

                  modalTitle.textContent = app.service;
                  modalBody.innerHTML = `
                      <p><strong>Bemor:</strong> ${app.title}</p>
                      <p><strong>Telefon:</strong> ${app.phone}</p>
                      <p><strong>Vaqt:</strong> ${formattedDateTime}</p>
                      <p><strong>Holati:</strong> <span class="badge rounded-pill text-capitalize" style="background-color: var(--${app.status === 'completed' ? 'success' : app.status === 'in-progress' ? 'primary' : 'warning'}-light); color: var(--${app.status === 'completed' ? 'success' : app.status === 'in-progress' ? 'primary' : 'warning'}-color);">${app.status}</span></p>
                  `;
                  detailModal.show();
              });

              timelineBody.appendChild(card);
          });
          
          updateNowIndicator(dateToRender);
      }

      function updateNowIndicator(dateToRender) {
          const now = new Date();
          const indicator = document.getElementById('timeline-now-indicator');
          if (dateToRender.toDateString() === now.toDateString()) {
              const top = ((now.getHours() - startHour) * 60 + now.getMinutes()) * (hourHeight / 60);
              if (top >= 0 && top < (endHour - startHour + 1) * hourHeight) {
                  indicator.style.display = 'block';
                  indicator.style.top = `${top}px`;
              } else {
                  indicator.style.display = 'none';
              }
          } else {
              indicator.style.display = 'none';
          }
      }

      // Event Listeners for navigation
      prevDayBtn.addEventListener('click', () => {
          currentDate.setDate(currentDate.getDate() - 1);
          renderTimeline(currentDate);
      });
      nextDayBtn.addEventListener('click', () => {
          currentDate.setDate(currentDate.getDate() + 1);
          renderTimeline(currentDate);
      });
      todayBtn.addEventListener('click', () => {
          currentDate = new Date();
          renderTimeline(currentDate);
      });
      datePicker.addEventListener('change', (e) => {
          // Adjust for timezone offset
          const selectedDate = new Date(e.target.value);
          const timezoneOffset = selectedDate.getTimezoneOffset() * 60000;
          currentDate = new Date(selectedDate.getTime() + timezoneOffset);
          renderTimeline(currentDate);
      });

      // Initial Render
      renderTimeline(currentDate);
      setInterval(() => updateNowIndicator(currentDate), 60000);

    });
  </script>

</body>
</html>
